language: cpp

sudo: required
dist: trusty

matrix:
  include:
    - os: osx
      osx_image: xcode7.3
      compiler: clang
    - os: linux
      compiler: clang
      env: COMPILER=clang++-3.7
      addons:
        apt:
          sources:
          - kalakris-cmake
          - ubuntu-toolchain-r-test
          - llvm-toolchain-precise-3.7
          packages:
          - cmake
          - clang-3.7
          - libc++-dev
          - libssl-dev
          - libc++abi-dev
    - os: linux
      compiler: gcc
      env: COMPILER=g++-5
      addons:
        apt:
          sources:
          - kalakris-cmake
          - ubuntu-toolchain-r-test
          packages:
          - cmake
          - g++-5
          - libssl-dev

before_install:
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then
      CXX=$COMPILER &&
      cd .. &&
      wget https://sourceforge.net/projects/boost/files/boost/1.60.0/boost_1_60_0.tar.gz &&
      tar xf boost_1_60_0.tar.gz &&
      cd boost_1_60_0 &&
      ./bootstrap.sh --with-libraries=random,chrono,system,thread,regex,filesystem,program_options &&
      ./b2 variant=release link=shared threading=multi runtime-link=shared install &&
      cd .. &&
      git clone --branch=development https://github.com/Microsoft/cpprestsdk.git &&
      cd cpprestsdk/Release &&
      sed -i '10d' CMakeLists.txt &&
      cmake -DBUILD_TESTS=OFF -DBUILD_SAMPLES=OFF -DCMAKE_BUILD_TYPE=Release &&
      sudo make install &&
      cd ../../twitter_cpp;
    else
      brew update &&
      brew install cmake &&
      brew install cpprestsdk &&
      brew link --force openssl;
    fi

script:
  - cmake -DCMAKE_BUILD_TYPE=Release
  - sudo make install

notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/ef4adc77ababc00645b7
    on_success: change
    on_failure: always
    on_start: never
